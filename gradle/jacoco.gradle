apply plugin: 'jacoco'

ext {
    jacocoExcludeList = []
    jacocoIncludeList = ['org.edu.ka.*']
    jacocoReportDir = "$buildDir/reports/jacoco"
    jacocoDestFile = "$buildDir/jacoco/jacocoTest.exec"
//    jacocoClassDumps = "$buildDir/jacoco/classpathdumps"
}

jacoco {
//    toolVersion = '0.7.5.201505241946'
    toolVersion = '0.7.1.201405082137'
    reportsDir = file(jacocoReportDir)
}

test {
    jacoco {
        includes = jacocoIncludeList
        excludes = jacocoExcludeList
        destinationFile = file(jacocoDestFile)
//        classDumpFile = file(jacocoClassDumps)
    }
}

task teamCityCodeCoverage(description: 'Used by TeamCity to generate code coverage report using all parameters defined in the build file') {
    doFirst {

        def relativeDestFile = jacocoDestFile - "${project.projectDir}${File.separatorChar}"

        def includeListStr = jacocoIncludeList.join(" ")
        def excludeListStr = jacocoExcludeList.join(" ")

        println("##teamcity[jacocoReport dataPath='${relativeDestFile}' includes='${includeListStr}' excludes='${excludeListStr}']")
    }
}

jacocoTestReport {
    reports {
        xml.enabled true
        csv.enabled false
        html.enabled true
    }
}